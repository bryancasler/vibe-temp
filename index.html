<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover, interactive-widget=resizes-content"
    />
    <link rel="stylesheet" href="styles.css" />
    <script src="scripts.js"></script>
  </head>
  <body>
    <div class="app">
      <header class="header">
        <div class="headline-wrap">
          <h1 class="headline">
            Vibe Temp
            <span class="sub">How it actually feels in shade and sun</span>
          </h1>
        </div>

        <div class="header-controls">
          <!-- Advanced Configuration -->
          <button
            id="advConfigBtn"
            class="theme-btn"
            type="button"
            title="Advanced Configuration"
          >
            ‚öôÔ∏è
          </button>
          <!-- Theme toggle -->
          <div class="theme-toggle" aria-label="Theme">
            <button
              id="themeToggle"
              class="theme-btn"
              type="button"
              title="Toggle dark/light theme"
            >
              &#127769;
            </button>
          </div>
          <!-- Unit toggle (saved to localStorage and syncs across tabs) -->
          <div class="unit-toggle" aria-label="Units">
            <button
              id="unitF"
              class="unit-btn"
              type="button"
              title="Switch to Fahrenheit"
            >
              &#176;F
            </button>
            <button
              id="unitC"
              class="unit-btn"
              type="button"
              title="Switch to Celsius"
            >
              &#176;C
            </button>
          </div>
        </div>
      </header>

      <!-- Error Message with Retry -->
      <div id="errorMessage" class="error-message" style="display: none">
        <div class="error-content">
          <div class="error-icon">‚ö†Ô∏è</div>
          <div class="error-text">
            <div class="error-title"></div>
            <div class="error-details"></div>
            <div class="error-suggestion"></div>
          </div>
        </div>
        <div class="error-actions">
          <div class="error-zip-input-wrapper" style="display: none">
            <input
              id="errorZipInput"
              class="error-zip-input"
              type="text"
              placeholder="Enter ZIP code (e.g., 20001)"
              maxlength="10"
            />
            <button
              id="errorZipSubmitBtn"
              class="error-action-btn error-zip-submit-btn"
              type="button"
            >
              Use ZIP
            </button>
          </div>
          <button
            id="errorRetryBtn"
            class="error-action-btn error-retry-btn"
            type="button"
            style="display: none"
          >
            Retry
          </button>
          <button
            id="errorDismissBtn"
            class="error-dismiss-btn"
            type="button"
            title="Dismiss error"
          >
            ‚úï
          </button>
        </div>
      </div>

      <!-- Two cards in one row -->
      <section class="cards">
        <article class="card card--sun" id="sunCard">
          <h3 class="card-title">Sun Vibe</h3>
          <div class="card-temp" id="sun">
            <span class="skeleton-text">‚Äî</span>
          </div>
          <div class="card-desc" id="sunLabel">
            <span class="skeleton-text">Loading‚Ä¶</span>
          </div>
        </article>

        <article class="card card--shade">
          <h3 class="card-title">Shade Vibe</h3>
          <div class="card-temp" id="shade">
            <span class="skeleton-text">‚Äî</span>
          </div>
          <div class="card-desc" id="shadeLabel">
            <span class="skeleton-text">Loading‚Ä¶</span>
          </div>
        </article>
      </section>

      <!-- Weather Summary -->
      <section
        id="weatherSummary"
        class="weather-summary"
        style="display: none"
      >
        <div class="summary-content">
          <div class="summary-header">
            <h3 class="summary-title">Highlighted Vibes</h3>
            <div class="summary-actions">
              <button
                id="copySummaryBtn"
                class="copy-summary-btn"
                type="button"
                title="Copy summary to clipboard"
                style="display: none"
              >
                üìã Copy
              </button>
              <button
                id="clearHighlight"
                class="clear-highlight-btn"
                type="button"
                title="Clear the highlighted time range selection"
                style="display: none"
              >
                ‚úï
              </button>
            </div>
          </div>
          <div id="summaryTimeRange" class="summary-time-range"></div>
          <div id="summaryText" class="summary-text">Generating summary...</div>
        </div>
      </section>

      <!-- Chart -->
      <section class="chart-wrap">
        <div class="chart-head">
          <div class="chart-title">24-Hour Forecast</div>
          <div class="chart-head-right">
            <div class="zip-input-wrapper">
              <label for="chartLocation" class="zip-label">ZIP</label>
              <div style="position: relative;">
                <input
                  type="text"
                  id="chartLocation"
                  class="chart-location-input"
                  placeholder="12345"
                  maxlength="5"
                  inputmode="numeric"
                  pattern="[0-9]*"
                  title="Enter 5-digit ZIP code"
                />
                <div class="zip-loading-spinner" id="zipLoadingSpinner" style="display: none;"></div>
              </div>
            </div>
            <div class="chart-status" id="chartStatus"></div>
          </div>
        </div>
        <div class="chart-box" id="chartBox">
          <div id="chartSkeleton" class="chart-skeleton">
            <div class="skeleton-line"></div>
            <div class="skeleton-line"></div>
            <div class="skeleton-line"></div>
          </div>
          <canvas id="vibeChart" style="display: none"></canvas>
        </div>
        <div class="chart-note">
          <small
            >üí° Tip:
            <span class="desktop-only">Hold Shift (or Ctrl/Cmd) and </span>drag
            on the graph to select a time range and share it</small
          >
        </div>
        <div class="time-presets">
          <button
            id="presetDefault"
            class="preset-btn active"
            type="button"
            title="Show 24-hour forecast"
          >
            24-Hour Forecast
          </button>
          <button
            id="presetToday"
            class="preset-btn"
            type="button"
            title="Show today only"
          >
            Today
          </button>
          <button
            id="presetTomorrow"
            class="preset-btn"
            type="button"
            title="Show tomorrow only"
          >
            Tomorrow
          </button>
          <button
            id="preset3Days"
            class="preset-btn"
            type="button"
            title="Show next 3 days"
          >
            3 Days
          </button>
          <button
            id="presetWeek"
            class="preset-btn"
            type="button"
            title="Show next week"
          >
            Week
          </button>
        </div>
        <div class="chart-shading-toggles">
          <label class="shading-toggle-label">
            <input
              id="nightShadingToggle"
              type="checkbox"
              checked
              title="Show darker shading on the graph for nighttime periods (between sunset and sunrise)"
            />
            <span class="toggle-switch"></span>
            <span>Day/Night</span>
          </label>
          <label class="shading-toggle-label">
            <input
              id="temperatureZonesToggle"
              type="checkbox"
              title="Show color-coded temperature comfort zones"
            />
            <span class="toggle-switch"></span>
            <span>Comfort Zones</span>
          </label>
          <label class="shading-toggle-label">
            <input
              id="humidityVisToggle"
              type="checkbox"
              title="Show humidity impact visualization (red tint for high humidity, blue for low)"
            />
            <span class="toggle-switch"></span>
            <span>Humidity</span>
          </label>
          <div class="toggle-subsection">
            <label class="shading-toggle-label">
              <input
                id="sunMarkersToggle"
                type="checkbox"
                checked
                title="Show sunrise and sunset icons on the chart"
              />
              <span class="toggle-switch"></span>
              <span>Sunrise/Sunset</span>
            </label>
            <label class="shading-toggle-label">
              <input
                id="rainIconsToggle"
                type="checkbox"
                checked
                title="Show rain icons on the chart"
              />
              <span class="toggle-switch"></span>
              <span>Rain</span>
            </label>
            <label class="shading-toggle-label">
              <input
                id="snowIconsToggle"
                type="checkbox"
                checked
                title="Show snow icons on the chart"
              />
              <span class="toggle-switch"></span>
              <span>Snow</span>
            </label>
            <label class="shading-toggle-label">
              <input
                id="iceIconsToggle"
                type="checkbox"
                checked
                title="Show ice icons on the chart"
              />
              <span class="toggle-switch"></span>
              <span>Ice</span>
            </label>
          </div>
        </div>
      </section>

      <!-- Status & quick controls -->
      <section class="controls">
        <div class="controls-left">
          <div
            id="favoritesDropdown"
            class="favorites-dropdown"
            style="display: none"
          >
            <button
              id="favoritesToggle"
              class="btn btn-secondary"
              type="button"
              title="Favorite locations"
            >
              ‚≠ê Favorites
            </button>
            <div id="favoritesList" class="favorites-list"></div>
          </div>
          <button
            id="notificationsBtn"
            class="btn btn-secondary"
            type="button"
            title="Enable notifications for vibe conditions"
            style="display: none"
          >
            üîî Notifications
          </button>
        </div>
        <div class="controls-right">
        </div>
      </section>

      <!-- Advanced Configuration Modal -->
      <div id="advConfigModal" class="modal-overlay" style="display: none">
        <div class="modal-content modal-large">
          <div class="modal-header">
            <h2 class="modal-title">Advanced Configuration</h2>
            <button
              id="advConfigClose"
              class="modal-close"
              type="button"
              title="Close"
            >
              ‚úï
            </button>
          </div>
          <div class="modal-body">
            <div id="advPanel" class="adv-panel">
          <div class="adv-grid">
            <!-- Inputs -->
            <div class="adv-col">
              <h4 class="adv-h4">Inputs</h4>
              <div class="fields-grid">
                <label class="field">
                  <span class="field-label"
                    >Air Temp (<span id="airUnitLabel">¬∞F</span>)</span
                  >
                  <input
                    id="temp"
                    type="number"
                    step="0.1"
                    placeholder="e.g., 75"
                    title="The actual air temperature in your location"
                  />
                </label>

                <label class="field">
                  <span class="field-label">Humidity (%)</span>
                  <input
                    id="humidity"
                    type="number"
                    step="1"
                    min="0"
                    max="100"
                    placeholder="e.g., 50"
                    title="Relative humidity percentage. Higher humidity makes it feel warmer in summer and colder in winter."
                  />
                </label>

                <label class="field">
                  <span class="field-label">Wind (mph)</span>
                  <input
                    id="wind"
                    type="number"
                    step="0.1"
                    min="0"
                    placeholder="e.g., 5"
                    title="Wind speed in miles per hour. Wind makes it feel cooler by increasing heat loss."
                  />
                </label>

                <div class="field span-2">
                  <label class="field-label">Solar Exposure (0‚Äì1)</label>
                  <div class="range-row">
                    <input
                      id="solar"
                      type="range"
                      min="0"
                      max="1"
                      step="0.1"
                      value="0.5"
                      title="How much direct sunlight you're exposed to. 0 = full shade, 1 = direct sun. Auto-calculated from UV Index and cloud cover."
                    />
                    <output id="solarVal" class="range-val">0.5</output>
                  </div>
                  <div class="hint">
                    Auto-calculated from UV Index & cloud cover by default
                  </div>
                </div>

                <label class="field">
                  <span class="field-label">Surface Reflectivity</span>
                  <select
                    id="reflect"
                    title="How much the ground/surfaces reflect heat back at you. Higher values (like snow) make you feel warmer."
                  >
                    <option value="0.2">Grass (~0.2)</option>
                    <option value="0.3" selected>Concrete (~0.3)</option>
                    <option value="0.5">Sand (~0.5)</option>
                    <option value="0.8">Snow (~0.8)</option>
                    <option value="0">Custom‚Ä¶</option>
                  </select>
                </label>

                <label class="field">
                  <span class="field-label">Custom Reflectivity (0‚Äì1)</span>
                  <input
                    id="reflectCustom"
                    type="number"
                    min="0"
                    max="1"
                    step="0.05"
                    value="0.3"
                    title="Custom reflectivity value. 0 = no reflection, 1 = maximum reflection. Used when 'Custom‚Ä¶' is selected above."
                  />
                </label>
              </div>
            </div>

            <!-- Location -->
            <div class="adv-col">
              <h4 class="adv-h4">Location</h4>
              <div class="adv-status" id="status">Trying to get your local weather‚Ä¶</div>

              <hr class="adv-sep" />

              <h4 class="adv-h4">Auto Updates</h4>
              <div class="row">
                <label class="inline">
                  <span>Update every</span>
                  <input
                    id="updateInterval"
                    type="number"
                    min="0.5"
                    step="0.5"
                    value="1"
                    class="w-6ch"
                  />
                  <span>minutes</span>
                </label>
              </div>
              <div class="row">
                <label class="inline">
                  <input id="updateHourlyToggle" type="checkbox" checked />
                  <span>Refresh hourly forecast too</span>
                </label>
              </div>
              <div class="row">
                <button id="updateNow" class="btn btn--sm" type="button">
                  Update Now
                </button>
              </div>
              <hr class="adv-sep" />
              <h4 class="adv-h4">Graph Display</h4>
              <div class="row">
                <label class="inline">
                  <span>Days ahead</span>
                  <input
                    id="daysAhead"
                    type="number"
                    min="1"
                    max="7"
                    step="1"
                    value="2"
                    class="w-6ch"
                    title="How many days into the future to show on the graph (1-7 days)"
                  />
                </label>
              </div>
              <hr class="adv-sep" />
              <h4 class="adv-h4">Chart Colors</h4>
              <div class="row">
                <label class="field">
                  <span class="field-label">Sun Vibe Start</span>
                  <input
                    id="sunColorStart"
                    type="color"
                    value="#ffb86b"
                    title="Starting color for Sun Vibe gradient"
                  />
                </label>
                <label class="field">
                  <span class="field-label">Sun Vibe End</span>
                  <input
                    id="sunColorEnd"
                    type="color"
                    value="#ff9500"
                    title="Ending color for Sun Vibe gradient"
                  />
                </label>
              </div>
              <div class="row">
                <label class="field">
                  <span class="field-label">Shade Vibe Start</span>
                  <input
                    id="shadeColorStart"
                    type="color"
                    value="#6ea8fe"
                    title="Starting color for Shade Vibe gradient"
                  />
                </label>
                <label class="field">
                  <span class="field-label">Shade Vibe End</span>
                  <input
                    id="shadeColorEnd"
                    type="color"
                    value="#4a90e2"
                    title="Ending color for Shade Vibe gradient"
                  />
                </label>
              </div>
              <div class="row">
                <button id="resetColors" class="btn btn--sm" type="button">
                  Reset to Defaults
                </button>
              </div>
              <hr class="adv-sep" />
              <h4 class="adv-h4">Formula Calibration</h4>
              <div class="hint" style="margin-bottom: 16px;">
                Adjust these coefficients to fine-tune the vibe temperature calculations based on your personal experience.
              </div>
              <div class="fields-grid">
                <div class="field span-2">
                  <label class="field-label">Humidity Impact</label>
                  <div class="range-row">
                    <input
                      id="calibHumidityCoeff"
                      type="range"
                      min="0.01"
                      max="0.2"
                      step="0.001"
                      value="0.0667"
                      title="How much humidity affects the feel (default: 0.0667 = 1/15)"
                    />
                    <output id="calibHumidityCoeffVal" class="range-val">0.0667</output>
                  </div>
                  <div class="hint">Higher values = humidity has more impact</div>
                </div>
                <div class="field span-2">
                  <label class="field-label">Humidity Baseline</label>
                  <div class="range-row">
                    <input
                      id="calibHumidityBaseline"
                      type="range"
                      min="20"
                      max="60"
                      step="1"
                      value="40"
                      title="Reference humidity level (default: 40%)"
                    />
                    <output id="calibHumidityBaselineVal" class="range-val">40</output>
                  </div>
                  <div class="hint">Humidity level where there's no adjustment</div>
                </div>
                <div class="field span-2">
                  <label class="field-label">Wind Cooling Effect</label>
                  <div class="range-row">
                    <input
                      id="calibWindCoeff"
                      type="range"
                      min="0.1"
                      max="2.0"
                      step="0.1"
                      value="0.7"
                      title="How much wind cools (default: 0.7)"
                    />
                    <output id="calibWindCoeffVal" class="range-val">0.7</output>
                  </div>
                  <div class="hint">Higher values = wind cools more</div>
                </div>
                <div class="field span-2">
                  <label class="field-label">Solar Warming Effect</label>
                  <div class="range-row">
                    <input
                      id="calibSolarCoeff"
                      type="range"
                      min="2"
                      max="15"
                      step="0.5"
                      value="8"
                      title="How much sun warms (default: 8)"
                    />
                    <output id="calibSolarCoeffVal" class="range-val">8</output>
                  </div>
                  <div class="hint">Higher values = sun warms more</div>
                </div>
                <div class="field span-2">
                  <label class="field-label">Reflectivity Effect</label>
                  <div class="range-row">
                    <input
                      id="calibReflectCoeff"
                      type="range"
                      min="1"
                      max="10"
                      step="0.5"
                      value="4"
                      title="How much surface reflection warms (default: 4)"
                    />
                    <output id="calibReflectCoeffVal" class="range-val">4</output>
                  </div>
                  <div class="hint">Higher values = reflective surfaces warm more</div>
                </div>
                <div class="field span-2">
                  <label class="field-label">Cloud Attenuation</label>
                  <div class="range-row">
                    <input
                      id="calibCloudExp"
                      type="range"
                      min="0.3"
                      max="1.2"
                      step="0.1"
                      value="0.7"
                      title="How clouds reduce solar exposure (default: 0.7)"
                    />
                    <output id="calibCloudExpVal" class="range-val">0.7</output>
                  </div>
                  <div class="hint">Higher values = clouds block more sun</div>
                </div>
              </div>
              <div class="row">
                <button id="resetCalibration" class="btn btn--sm" type="button">
                  Reset Calibration to Defaults
                </button>
              </div>
            </div>

            <!-- Formula -->
            <div class="adv-col">
              <h4 class="adv-h4">Formula</h4>
              <pre class="formula">
          ShadeVibe(T, RH, Wind) = T + (RH - 40) / 15 - 0.7 √ó Wind
          
          SunVibe(ShadeVibe, Solar, Reflect) = ShadeVibe + 8 √ó Solar + 4 √ó Reflect
                    </pre
              >
              <div class="hint">
                Solar is auto-derived from UV Index (vs clear-sky UV) and cloud
                cover, and zeroed at night. Reflectivity influences how much
                extra radiant heat you feel.
              </div>
            </div>
          </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="notification" class="notification" style="display: none"></div>


    <!-- Expired Selection Modal -->
    <div
      id="expiredModal"
      class="modal-overlay"
      style="display: none"
      role="dialog"
      aria-labelledby="modalTitle"
      aria-modal="true"
    >
      <div class="modal-dialog">
        <h3 id="modalTitle" class="modal-title">Time Range Expired</h3>
        <p class="modal-message">The highlighted time range has passed.</p>
        <div class="modal-buttons">
          <button
            id="keepCustomBtn"
            class="modal-btn modal-btn-primary"
            type="button"
          >
            Keep Custom Settings
          </button>
          <button id="useDefaultsBtn" class="modal-btn" type="button">
            Use Defaults
          </button>
        </div>
      </div>
    </div>

    <!-- Keyboard Shortcuts Help Modal -->
    <div
      id="shortcutsModal"
      class="modal-overlay"
      style="display: none"
      role="dialog"
      aria-labelledby="shortcutsModalTitle"
      aria-modal="true"
    >
      <div class="modal-dialog">
        <h3 id="shortcutsModalTitle" class="modal-title">Keyboard Shortcuts</h3>
        <div class="shortcuts-list">
          <div class="shortcut-item">
            <kbd>C</kbd>
            <span>Clear highlight</span>
          </div>
          <div class="shortcut-item">
            <kbd>S</kbd>
            <span>Share/copy selection URL</span>
          </div>
          <div class="shortcut-item">
            <kbd>F</kbd>
            <span>Toggle Fahrenheit</span>
          </div>
          <div class="shortcut-item">
            <kbd>?</kbd> or <kbd>H</kbd>
            <span>Show this help</span>
          </div>
          <div class="shortcut-item">
            <kbd>Esc</kbd>
            <span>Close modals/clear selection</span>
          </div>
        </div>
        <div class="modal-buttons">
          <button
            id="closeShortcutsBtn"
            class="modal-btn modal-btn-primary"
            type="button"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
